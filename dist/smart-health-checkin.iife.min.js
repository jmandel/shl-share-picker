(()=>{var{defineProperty:N,getOwnPropertyNames:U,getOwnPropertyDescriptor:I}=Object,Q=Object.prototype.hasOwnProperty;var _=new WeakMap,b=(x)=>{var z=_.get(x),w;if(z)return z;if(z=N({},"__esModule",{value:!0}),x&&typeof x==="object"||typeof x==="function")U(x).map((C)=>!Q.call(z,C)&&N(z,C,{get:()=>x[C],enumerable:!(w=I(x,C))||w.enumerable}));return _.set(x,z),z};var q=(x,z)=>{for(var w in z)N(x,w,{get:z[w],enumerable:!0,configurable:!0,set:(C)=>z[w]=()=>C})};var v={};q(v,{request:()=>A,renderReturnUI:()=>P,rehydrateResponse:()=>W,parseReturnHash:()=>V,maybeHandleReturn:()=>B,broadcastResponse:()=>O});function $(){let x=new Uint8Array(16);return crypto.getRandomValues(x),Array.from(x).map((z)=>z.toString(16).padStart(2,"0")).join("")}function V(x){if(!x||x==="#")return null;let z=x.startsWith("#")?x.slice(1):x,w=new URLSearchParams(z),C=w.get("state");if(!C)return null;let E=w.get("error");if(E)return{type:"error",state:C,error:E,error_description:w.get("error_description")||void 0};let F=w.get("vp_token"),K=w.get("smart_artifacts");if(F&&K)return{type:"success",state:C,vp_token:JSON.parse(F),smart_artifacts:JSON.parse(K)};return null}function O(x,z){let w=new BroadcastChannel("shl-"+x);w.postMessage({state:x,...z}),w.close()}function W(x){let z={};for(let[w,C]of Object.entries(x.vp_token))z[w]=C.map((E)=>{let F=x.smart_artifacts[E.artifact];return F?.data!==void 0?F.data:F});return{...x,credentials:z}}async function A(x,z){let w=z.checkinBase.replace(/\/+$/,"");if(!w)throw Error("checkinBase required");if(!x||!Array.isArray(x.credentials))throw Error("dcqlQuery must be an object with a credentials array");let C=$(),E=$(),F=z.rehydrate!==!1,K=z.timeout??120000,L=new BroadcastChannel("shl-"+C),J=null,S=new Promise((j,Z)=>{let k=setTimeout(()=>{M(),Z(Error("Request timeout"))},K);L.onmessage=(f)=>{let D=f.data;if(!D||D.state!==C)return;if(D.error){M();let G=Error(D.error_description||D.error);G.code=D.error,G.state=D.state,Z(G);return}if(D.vp_token&&D.smart_artifacts){M();let G={state:D.state,vp_token:D.vp_token,smart_artifacts:D.smart_artifacts};j(F?W(G):G)}};function M(){clearTimeout(k),L.close();try{if(J&&!J.closed)J.close()}catch{}}}),X=new URL(location.href);X.hash="";let Y=`redirect_uri:${X.toString()}`,T=new URLSearchParams({client_id:Y,response_type:"vp_token",response_mode:"fragment",nonce:E,state:C,dcql_query:JSON.stringify(x)});if(z.onRequestStart)z.onRequestStart({client_id:Y,response_type:"vp_token",response_mode:"fragment",state:C,nonce:E,dcql_query:x});let H=`${w}/?${T.toString()}`;if(J=window.open(H,"_blank"),!J)throw L.close(),Error("Popup blocked - please allow popups for this site");return S}function P(x,z){document.body.textContent="";let w=document.createElement("div");w.style.cssText="font-family:system-ui;padding:40px;text-align:center;background:#0f141c;color:#e9eef5;min-height:100vh";let C=document.createElement("h1");C.style.cssText=x?"color:#4ade80":"color:#f87171",C.textContent=x?"✓ Shared":"✗ Not Shared";let E=document.createElement("p");E.textContent=z,w.appendChild(C),w.appendChild(E),document.body.appendChild(w)}async function B(x={}){let z=x.renderUI!==!1,w=V(location.hash);if(!w)return!1;if(w.type==="error"){if(O(w.state,{error:w.error,error_description:w.error_description}),z)P(!1,w.error_description||w.error),window.close();return!0}if(w.type==="success"){if(O(w.state,{vp_token:w.vp_token,smart_artifacts:w.smart_artifacts}),z)P(!0,"You can close this window."),window.close();return!0}return!1}if(typeof window<"u")window.SHL={request:A,maybeHandleReturn:B,parseReturnHash:V,rehydrateResponse:W};})();
